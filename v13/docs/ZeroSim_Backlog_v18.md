# Zero-Sim Hardening Backlog (v18 Legacy Code)

> **Status**: Backlog
> **Count**: ~75 Violations
> **Generated By**: `scripts/check_zero_sim.py`
> **Target**: Post-HSMF Hardening Phase

## 1. Overview

The `check_zero_sim.py` scanner identified approximately 75 violations of the Zero-Simulation / Determinism policy in the codebase, primarily within legacy `v18` modules and shared libraries.

To achieve full fabric readiness, these must be refactored to use deterministic equivalents.

## 2. Violation Categories

### Category A: Floating Point Logic (Highest Priority)

**Issue**: Usage of `float()` or standard Python floating point math in economic or consensus pathways.
**Fix**: Replace with `BigNum128`.

* `v18/cluster/cluster_adapter.py`: multiple `float()` calls.
* `v13/core/economics/`: (Check scanner output for specific files).

### Category B: Non-Deterministic Time

**Issue**: Usage of `time.time()`, `datetime.now()`, or `time.sleep()`.
**Fix**: Inject `deterministic_timestamp` from the Block/Event context.

* `v13/core/evidence/bus.py`: Timestamp generation on event ingestion (needs to move to upstream source or strictly increasing logical clock).
* `v13/libs/`: Various utility timeouts.

### Category C: Randomness

**Issue**: usage of `import random`.
**Fix**: Use `CertifiedMath` PRNG seeded by block hash/seed.

## 3. How to Refactor

1. **Run the Scanner**:

    ```bash
    python scripts/check_zero_sim.py
    ```

2. **Pick a File**: Select a file from the `[FAIL]` list.

3. **Apply Fixes**:
    * **Float**: `val = float(x)` -> `val = BigNum128.from_string(str(x))`
    * **Time**: `now = time.time()` -> `now = self.clock.now()` (if logical clock available) or pass `timestamp` in implementation arguments.
    * **Random**: `random.choice(x)` -> `utils.deterministic_choice(x, seed)`

4. **Verify**: Re-run scanner and ensure violation count decreases.

## 4. Prioritized File List (Partial)

(Generated from scanner output)

* `v18/cluster/cluster_adapter.py`
* `v13/core/evidence/bus.py`
* ... (Run script for full list)
