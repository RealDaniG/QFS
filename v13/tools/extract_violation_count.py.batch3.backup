#!/usr/bin/env python3
"""
Extract violation count from AST checker output
"""

import re
import sys


def extract_violation_count(filepath):
    """Extract violation count from AST checker output file"""
    try:
        with open(filepath, "r", encoding="utf-8") as f:
            content = f.read()

        # Pattern: [FAIL] 2390 violations found:
        match = re.search(r"\[FAIL\]\s+(\d+)\s+violations found", content)
        if match:
            return int(match.group(1))

        # Check for success
        if "[OK] Zero-Simulation compliance verified" in content:
            return 0

        return None
    except Exception as e:
        print(f"Error reading file: {e}", file=sys.stderr)
        return None


if __name__ == "__main__":
    filepath = sys.argv[1] if len(sys.argv) > 1 else "post_batch2_violations.txt"
    count = extract_violation_count(filepath)

    if count is not None:
        print(count)
        sys.exit(0)
    else:
        print("Could not extract violation count", file=sys.stderr)
        sys.exit(1)
