============================= test session starts =============================
platform win32 -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- C:\Python313\python.exe
cachedir: .pytest_cache
hypothesis profile 'default'
benchmark: 5.2.2 (defaults: timer=time.perf_counter disable_gc=False min_rounds=5 min_time=0.000005 max_time=1.0 calibration_precision=10 warmup=False warmup_iterations=100000)
rootdir: D:\AI AGENT CODERV1\QUANTUM CURRENCY\QFS\V13
configfile: pytest.ini
plugins: anyio-4.11.0, hypothesis-6.148.2, asyncio-1.2.0, benchmark-5.2.2, cov-7.0.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 4 items

tests\test_auth.py::test_get_challenge PASSED                            [ 25%]
tests\test_auth.py::test_verify_with_challenge FAILED                    [ 50%]
tests\test_auth.py::test_verify_expired_challenge PASSED                 [ 75%]
tests\test_auth.py::test_protected_endpoint_requires_auth PASSED         [100%]

================================== FAILURES ===================================
_________________________ test_verify_with_challenge __________________________

    def test_verify_with_challenge():
        """Test auth verification flow."""
        # 1. Get challenge
        challenge_response = client.get("/api/v18/auth/challenge?wallet=0xTEST")
        challenge = challenge_response.json()
    
        # 2. Verify (mock signature)
        verify_payload = {
            "wallet_address": "0xTEST",
            "signature": "0xMOCK_SIGNATURE",
            "challenge_id": challenge["challenge_id"],
        }
    
        verify_response = client.post("/api/v18/auth/verify", json=verify_payload)
    
        assert verify_response.status_code == 200
        data = verify_response.json()
    
        assert "session_token" in data
        assert "expires_at" in data
>       assert data["wallet_address"] == "0xtest"
E       AssertionError: assert '0xTEST' == '0xtest'
E         
E         - 0xtest
E         + 0xTEST

tests\test_auth.py:52: AssertionError
---------------------------- Captured stdout call -----------------------------
{"asctime": "2025-12-22 09:48:16,912", "levelname": "INFO", "name": "httpx", "message": "HTTP Request: GET http://testserver/api/v18/auth/challenge?wallet=0xTEST \"HTTP/1.1 200 OK\""}
{"asctime": "2025-12-22 09:48:16,914", "levelname": "INFO", "name": "httpx", "message": "HTTP Request: POST http://testserver/api/v18/auth/verify \"HTTP/1.1 200 OK\""}
------------------------------ Captured log call ------------------------------
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/api/v18/auth/challenge?wallet=0xTEST "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1025 HTTP Request: POST http://testserver/api/v18/auth/verify "HTTP/1.1 200 OK"
============================== warnings summary ===============================
C:\Users\Usuario\AppData\Roaming\Python\Python313\site-packages\starlette\formparsers.py:12
  C:\Users\Usuario\AppData\Roaming\Python\Python313\site-packages\starlette\formparsers.py:12: PendingDeprecationWarning: Please use `import python_multipart` instead.
    import multipart

C:\Users\Usuario\AppData\Roaming\Python\Python313\site-packages\pythonjsonlogger\jsonlogger.py:11
  C:\Users\Usuario\AppData\Roaming\Python\Python313\site-packages\pythonjsonlogger\jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

C:\Users\Usuario\AppData\Roaming\Python\Python313\site-packages\pydantic\_internal\_config.py:323
C:\Users\Usuario\AppData\Roaming\Python\Python313\site-packages\pydantic\_internal\_config.py:323
  C:\Users\Usuario\AppData\Roaming\Python\Python313\site-packages\pydantic\_internal\_config.py:323: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
    warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)

v13/atlas/tests/test_auth.py::test_verify_with_challenge
  D:\AI AGENT CODERV1\QUANTUM CURRENCY\QFS\V13\v13\atlas\src\api\dependencies.py:17: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    "iat": datetime.utcnow(),

v13/atlas/tests/test_auth.py::test_verify_with_challenge
  D:\AI AGENT CODERV1\QUANTUM CURRENCY\QFS\V13\v13\atlas\src\api\dependencies.py:18: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    "exp": datetime.utcnow() + timedelta(hours=settings.SESSION_EXPIRY_HOURS),

v13/atlas/tests/test_auth.py::test_verify_with_challenge
  D:\AI AGENT CODERV1\QUANTUM CURRENCY\QFS\V13\v13\atlas\src\api\routes\auth.py:87: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    datetime.datetime.utcnow() + datetime.timedelta(hours=24)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
FAILED tests\test_auth.py::test_verify_with_challenge - AssertionError: asser...
=================== 1 failed, 3 passed, 7 warnings in 2.11s ===================
