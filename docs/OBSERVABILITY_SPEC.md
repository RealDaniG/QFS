# Observability Specification (V18)

## 1. Backend Logging Standards

All API services must adhere to the following structured logging format (JSON preferred in production, Text in dev):

**Format:**
`[TIMESTAMP] [LEVEL] [MODULE] [REQUEST_ID] Message {metadata}`

**Events to Log:**

- **Auth**:
  - `INFO`: Session created (Wallet: `...1234`).
  - `WARN`: Invalid signature attempt.
  - `ERROR`: Token generation failure.
- **Governance**:
  - `INFO`: Proposal created, Vote cast.
  - `WARN`: Vote rejected (eligibility).
- **Content**:
  - `INFO`: Content published (CID: `...`).
  - `ERROR`: Replication failure.

**HTTP Access Logs:**

- Must include: `Method`, `Path`, `Status Code`, `Latency (ms)`, `User-Agent`.

## 2. Metrics (Prometheus/OpenTelemetry)

- **Counters**:
  - `http_requests_total{method, status, route}`
  - `proposals_created_total`
  - `votes_cast_total`
- **Gauges**:
  - `active_sessions`
  - `connected_peers`

## 3. Frontend Telemetry

- **Client-side Errors**: Capture uncaught expectations and send to `/api/v1/telemetry/error` (to be implemented).
- **Performance**: Track "Time to First Byte" and "Time to Interactive" for Dashboard.

## 4. Dashboard

Logs should be shipped to a centralized aggregator (e.g., ELK Stack, Loki) for visualization.

## 5. Implementation (V18 Integration Phase)

Actual log files generated by the `run_atlas_full.ps1` orchestrator:

- **`logs/atlas_full_run.log`**: Master orchestration log (Startup, Test Results, Summary).
- **`logs/backend_stdio.log`**: Full standard output/error from Uvicorn Backend (includes HTTP Access Logs).
- **`logs/frontend_stdio.log`**: Next.js build and runtime logs.
- **`logs/v18_integration_log.txt`**: Persistent log for specific critical errors caught by `main_minimal` exception handlers.
