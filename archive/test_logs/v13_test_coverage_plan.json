{
  "phase": "Coverage Improvement Plan (Phase A–D)",
  "principles": [
    "Do not change protocol-level semantics in TreasuryEngine/RewardAllocator/HarmonicEconomics/guards during coverage work.",
    "Prefer test-only shims in v13/tests to stabilize collection (CertifiedMath/PQC drift) rather than mutating core libs.",
    "Gate environment-dependent tests (real PQC backends, large integration suites) with markers and skip logic.",
    "Keep ATLAS tests green as a baseline and expand API boundary tests iteratively."
  ],
  "phases": [
    {
      "name": "Phase A – Collection stabilization + economic invariants",
      "priority": "high",
      "tasks": [
        {
          "id": "A1_certifiedmath_import_stabilization",
          "description": "Stabilize CertifiedMath usage in v13/tests by standardizing imports to v13.libs.CertifiedMath or adding test-only compatibility shims/aliases.",
          "target_files": [
            "v13/tests/conftest.py",
            "v13/tests/unit/test_certified_math_edge_cases.py",
            "v13/tests/unit/test_certified_math_performance.py",
            "v13/tests/unit/test_certifiedmath_fixes.py"
          ],
          "priority": "high"
        },
        {
          "id": "A2_pqc_api_stabilization",
          "description": "Gate real-PQC-backend-dependent tests and fix PQC import/API mismatch in tests expecting module-level functions (generate_keypair/sign_data) by using PQC class APIs or test-side shims.",
          "target_files": [
            "v13/tests/conftest.py",
            "v13/tests/pqc/test_pqc.py",
            "v13/tests/pqc/test_pqc_key_management.py",
            "v13/tests/unit/integration/test_token_state_bundle.py"
          ],
          "priority": "high"
        },
        {
          "id": "A3_quarantine_legacy_suites",
          "description": "Quarantine known-legacy suites (v13/tests/old, unstable integration scripts) behind markers so unit tests can run in CI/dev reliably.",
          "target_files": [
            "v13/tests/conftest.py",
            "v13/tests/old/*"
          ],
          "priority": "high"
        },
        {
          "id": "A4_treasury_reward_invariants",
          "description": "Add invariant-focused tests for TreasuryEngine/RewardAllocator: conservation, cap enforcement, negative/overflow boundaries. Tests should be deterministic and replayable.",
          "target_files": [
            "v13/tests/phase3/treasury/test_reward_caps_and_conservation.py",
            "v13/tests/unit/test_reward_system.py"
          ],
          "priority": "high"
        }
      ]
    },
    {
      "name": "Phase B – API/security boundary",
      "priority": "high",
      "tasks": [
        {
          "id": "B1_atlas_wallets_auth_policy",
          "description": "Add ATLAS API tests for /wallets endpoints: auth required, validation failures, policy boundary checks.",
          "target_files": [
            "v13/ATLAS/src/api/routes/wallets.py",
            "v13/ATLAS/src/api/routes/transactions.py",
            "v13/ATLAS/src/api/dependencies.py",
            "v13/ATLAS/src/tests/test_atlas_api_wallets_auth_and_policy.py"
          ],
          "priority": "high",
          "status": "completed"
        },
        {
          "id": "B2_atlas_metrics_proofs",
          "description": "Add ATLAS API tests for /metrics and /proofs endpoints: success paths, missing dependency paths, and error branches.",
          "target_files": [
            "v13/ATLAS/src/api/routes/metrics.py",
            "v13/ATLAS/src/api/routes/proofs.py",
            "v13/ATLAS/src/tests/test_metrics_and_proofs_endpoints.py"
          ],
          "priority": "high",
          "status": "completed"
        }
      ]
    },
    {
      "name": "Phase C – Observability & explanation",
      "priority": "medium",
      "tasks": [
        {
          "id": "C1_humor_observatory_aggregates",
          "description": "Ensure humor observability/explainability helpers are tested for deterministic output and stable schemas.",
          "target_files": [
            "v13/policy/humor_observatory.py",
            "v13/policy/humor_explainability.py",
            "v13/tests/test_humor_observatory.py",
            "v13/tests/test_humor_explainability.py"
          ],
          "priority": "medium"
        },
        {
          "id": "C2_value_graph_keep_green",
          "description": "Keep V13.8 value-node/value-graph tests green and extend coverage only within tests/value_node/*.",
          "target_files": [
            "v13/ATLAS/src/value_graph_ref.py",
            "v13/ATLAS/tests/value_node/test_value_graph_ref.py",
            "v13/ATLAS/tests/value_node/test_value_node_replay.py"
          ],
          "priority": "medium"
        }
      ]
    },
    {
      "name": "Phase D – Tooling",
      "priority": "low",
      "tasks": [
        {
          "id": "D1_evidence_indexer_tests",
          "description": "Add minimal tests for evidence_indexer (path scanning, JSON schema sanity) and treat other pure scripts as excluded unless needed.",
          "target_files": [
            "v13/tools/evidence_indexer.py",
            "v13/tests/tools/test_evidence_indexer.py"
          ],
          "priority": "low"
        }
      ]
    }
  ]
}
