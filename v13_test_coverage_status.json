{
  "phase": "Initial Coverage Analysis",
  "coverage_summary": {
    "overall_percent": 22.6,
    "qfs_core_percent": 17.2,
    "atlas_percent": 52.0,
    "notes": [
      "Coverage numbers are from combined coverage data after running the ATLAS Python test suites with coverage.py.",
      "The full QFS core pytest suite (v13/tests via pytest.ini) still has significant collection/runtime failures; those blockers are tracked below and will be addressed before attempting a complete QFS-core coverage run."
    ]
  },
  "collection_blockers": {
    "qfs_core": [
      {
        "category": "CertifiedMath import/API drift",
        "symptoms": [
          "Many tests import from 'CertifiedMath' directly and/or expect symbols that are not present (e.g., PHI_INTENSITY_B, LogContext).",
          "Some tests fail at runtime due to 'BigNum128' lacking expected attributes (e.g., log_list)."
        ],
        "examples": [
          "v13/tests/unit/test_certified_math_edge_cases.py",
          "v13/tests/unit/test_certified_math_performance.py",
          "v13/tests/unit/test_certifiedmath_fixes.py"
        ]
      },
      {
        "category": "PQC import/API mismatch",
        "symptoms": [
          "Some tests import PQC as a module and expect top-level functions (generate_keypair/sign_data) that do not exist as module-level exports.",
          "Production PQC backend availability varies; tests requiring real Dilithium must be gated/skipped when only MockPQC is available."
        ],
        "examples": [
          "v13/tests/pqc/test_pqc.py",
          "v13/tests/pqc/test_pqc_key_management.py",
          "v13/tests/unit/integration/test_token_state_bundle.py"
        ]
      },
      {
        "category": "Legacy/old test suites",
        "symptoms": [
          "Several files under v13/tests/old and v13/tests/* have legacy assumptions and fail collection in current structure."
        ],
        "examples": [
          "v13/tests/old/test_all_operations.py",
          "v13/tests/old/test_drv_chain.py"
        ]
      }
    ],
    "atlas": []
  },
  "tests_run": [
    "python -m pytest v13/ATLAS/src/tests v13/ATLAS/src/secure_chat/tests v13/ATLAS/tests/value_node -q",
    "python -m coverage run --data-file=.coverage.atlas -m pytest v13/ATLAS/src/tests v13/ATLAS/src/secure_chat/tests v13/ATLAS/tests/value_node -q",
    "python -m coverage combine",
    "python -m coverage report -m",
    "python -m coverage report --include=\"v13/ATLAS/src/*\" -m",
    "python -m coverage report --include=\"v13/*\" --omit=\"v13/ATLAS/*\" -m",
    "python -m pytest v13\\ATLAS\\src\\tests -q",
    "python -m coverage run --data-file=.coverage.atlas -m pytest v13\\ATLAS\\src\\tests v13\\ATLAS\\src\\secure_chat\\tests v13\\ATLAS\\tests\\value_node -q",
    "python -m coverage report --include=\"v13/ATLAS/src/api/routes/metrics.py,v13/ATLAS/src/api/routes/proofs.py,v13/ATLAS/src/api/routes/wallets.py,v13/ATLAS/src/api/routes/transactions.py\" -m",
    "python -m pytest v13\\ATLAS\\src\\tests -q",
    "python -m coverage run --data-file=.coverage.atlas -m pytest v13\\ATLAS\\src\\tests v13\\ATLAS\\src\\secure_chat\\tests v13\\ATLAS\\tests\\value_node -q",
    "python -m coverage report --include=\"v13/ATLAS/src/*\" -m"
  ],
  "qfs_core_modules": [
    {
      "module_path": "v13/libs/encoding/canonical.py",
      "coverage_percent": 0.0,
      "missing_areas": ["canonical serialization helpers untested", "no unit tests exercising canonical encode/decode"]
    },
    {
      "module_path": "v13/libs/encoding/__init__.py",
      "coverage_percent": 0.0,
      "missing_areas": ["package import smoke tests"]
    },
    {
      "module_path": "v13/tools_root/ast_checker.py",
      "coverage_percent": 0.0,
      "missing_areas": ["tooling not exercised by tests", "consider excluding or adding minimal CLI tests"]
    },
    {
      "module_path": "v13/tools_root/deterministic_hash_check.py",
      "coverage_percent": 0.0,
      "missing_areas": ["tooling not exercised by tests"]
    },
    {
      "module_path": "v13/tools_root/validate_pqc_integrity.py",
      "coverage_percent": 0.0,
      "missing_areas": ["tooling not exercised by tests"]
    },
    {
      "module_path": "v13/sdk/QFSV13SDK.py",
      "coverage_percent": 0.0,
      "missing_areas": ["SDK integration tests", "API surface smoke tests"]
    },
    {
      "module_path": "v13/services/aegis_api.py",
      "coverage_percent": 0.0,
      "missing_areas": ["service integration tests", "error-handling branches"]
    },
    {
      "module_path": "v13/libs/economics/PsiFieldEngine.py",
      "coverage_percent": 7.5,
      "missing_areas": ["field evolution paths", "boundary-condition tests", "deterministic replay cases"]
    },
    {
      "module_path": "v13/libs/economics/PsiSyncProtocol.py",
      "coverage_percent": 8.6,
      "missing_areas": ["sync handshake paths", "message validation", "error branches"]
    },
    {
      "module_path": "v13/libs/economics/TreasuryDistributionEngine.py",
      "coverage_percent": 12.2,
      "missing_areas": ["distribution correctness", "cap enforcement", "budget conservation"]
    },
    {
      "module_path": "v13/services/ledger_economics_service.py",
      "coverage_percent": 12.4,
      "missing_areas": ["service-level integration", "failure mode tests"]
    },
    {
      "module_path": "v13/libs/governance/TreasuryEngine.py",
      "coverage_percent": 14.1,
      "missing_areas": ["mint/burn invariants", "cap enforcement", "conservation checks"]
    },
    {
      "module_path": "v13/libs/economics/HarmonicEconomics.py",
      "coverage_percent": 15.7,
      "missing_areas": ["economic invariant tests", "edge cases for overflow/underflow", "integration with guard checks"]
    },
    {
      "module_path": "v13/libs/governance/InfrastructureGovernance.py",
      "coverage_percent": 16.6,
      "missing_areas": ["proposal lifecycle", "vote tallying edge cases", "policy gating"]
    },
    {
      "module_path": "v13/core/StorageEngine.py",
      "coverage_percent": 17.4,
      "missing_areas": ["dual-write paths", "error-handling branches", "CIR-302 incident regressions"]
    }
  ],
  "atlas_modules": [
    {
      "module_path": "v13/ATLAS/src/secure_chat/storage/ipfs_storage.py",
      "coverage_percent": 0.0,
      "missing_areas": ["no unit tests", "IPFS-unavailable behavior", "cache path coverage"]
    },
    {
      "module_path": "v13/ATLAS/src/signals/humor_v2.py",
      "coverage_percent": 0.0,
      "missing_areas": ["no tests referencing humor_v2", "policy gating integration"]
    },
    {
      "module_path": "v13/ATLAS/src/signals/humor_zerosim.py",
      "coverage_percent": 0.0,
      "missing_areas": ["zerosim compliance tests not executed against this module"]
    },
    {
      "module_path": "v13/ATLAS/src/signals/humor.py",
      "coverage_percent": 12.7,
      "missing_areas": ["vector computation branches", "policy gating", "boundary cases"]
    },
    {
      "module_path": "v13/ATLAS/src/api/routes/proofs.py",
      "coverage_percent": 57.6,
      "missing_areas": ["auth failures", "invalid payload handling", "proof verification branches"]
    },
    {
      "module_path": "v13/ATLAS/src/api/routes/metrics.py",
      "coverage_percent": 35.9,
      "missing_areas": ["StorageEngine missing/unavailable cases", "prometheus formatting", "error branches"]
    },
    {
      "module_path": "v13/ATLAS/src/api/routes/quantum.py",
      "coverage_percent": 26.6,
      "missing_areas": ["input validation", "error handling", "quantum-engine boundary cases"]
    },
    {
      "module_path": "v13/ATLAS/src/core/transaction_processor.py",
      "coverage_percent": 27.1,
      "missing_areas": ["invalid operations", "nonce edge cases", "receipt/event emission"]
    },
    {
      "module_path": "v13/ATLAS/src/api/routes/wallets.py",
      "coverage_percent": 51.9,
      "missing_areas": ["auth boundary", "balance/locked validations", "transfer edge cases"]
    },
    {
      "module_path": "v13/ATLAS/src/api/routes/transactions.py",
      "coverage_percent": 31.9,
      "missing_areas": ["auth boundary", "invalid tx schema", "policy/guard errors"]
    },
    {
      "module_path": "v13/ATLAS/src/core/economic_views.py",
      "coverage_percent": 100.0,
      "missing_areas": ["expand view models to include explainability hooks once API provides event traces"]
    }
  ],
  "critical_modules": [
    {
      "module": "v13/libs/governance/TreasuryEngine.py",
      "coverage_percent": 14.1,
      "missing_areas": [
        "reward/mint/burn path assertions",
        "budget + cap enforcement edge cases",
        "conservation invariant proofs in unit tests"
      ]
    },
    {
      "module": "v13/libs/governance/RewardAllocator.py",
      "coverage_percent": 19.7,
      "missing_areas": [
        "bonus cap enforcement",
        "policy gating behavior",
        "boundary-condition tests for allocation limits"
      ]
    },
    {
      "module": "v13/libs/economics/HarmonicEconomics.py",
      "coverage_percent": 15.7,
      "missing_areas": [
        "end-to-end invariants under replay",
        "edge cases for negative/overflow/underflow handling",
        "integration with guard checks"
      ]
    }
  ],
  "api_modules": [
    {
      "module": "v13/ATLAS/src/api/routes/secure_chat.py",
      "coverage_percent": 62.1,
      "missing_areas": [
        "thread-detail and status update paths",
        "error-handling branches",
        "authorization negative paths beyond basic cases"
      ]
    },
    {
      "module": "v13/ATLAS/src/api/routes/transactions.py",
      "coverage_percent": 33.3,
      "missing_areas": [
        "validation failures",
        "policy/guard boundary behavior"
      ]
    },
    {
      "module": "v13/ATLAS/src/api/routes/wallets.py",
      "coverage_percent": 31.5,
      "missing_areas": [
        "transfer edge cases",
        "nonce/balance boundary validations"
      ]
    }
  ],
  "observability_modules": [
    {
      "module": "v13/ATLAS/src/value_graph_ref.py",
      "coverage_percent": 97.3,
      "missing_areas": [
        "minor branch edges (non-critical)"
      ]
    },
    {
      "module": "v13/ATLAS/src/secure_chat/core/engine.py",
      "coverage_percent": 80.7,
      "missing_areas": [
        "some error/permission branches"
      ]
    }
  ],
  "next_actions": [
    "Phase A (Foundation): stabilize QFS-core test collection by normalizing CertifiedMath and PQC import paths and gating real-PQC-only tests; then re-run coverage for v13/tests.",
    "Phase A (Invariants): add/extend unit tests for TreasuryEngine and RewardAllocator focusing on conservation, caps, and deterministic replay invariants.",
    "Phase B (API/Security): expand ATLAS API tests for transactions/wallets/metrics/proofs including auth failure modes and policy boundary enforcement.",
    "Phase C (Observability): extend explainability + observatory tests (humor, value graph, metrics endpoints) while staying read-only over economics.",
    "Phase D (Tooling): add tests for evidence_indexer and CI scripts where practical; mark pure scripts as excluded from coverage if not intended for runtime." 
  ]
}
